# 谱面格式指南 (Chart Format Guide)

## 文件结构

每个歌曲需要创建一个独立的文件夹，放在 `songs/` 目录下：

```
songs/
└── your-song-name/
    ├── chart.json    # 谱面文件
    └── music.wav     # 音乐文件 (支持 .wav, .mp3, .aiff)
```

## chart.json 格式说明

```json
{
  "song_name": "歌曲名称",
  "artist": "艺术家/作者",
  "bpm": 120,
  "difficulty": "Easy/Normal/Hard/Expert",
  "music_path": "songs/your-song-name/music.wav",
  "notes": [
    {"time": 1000, "lane": 0},
    {"time": 1500, "lane": 1}
  ]
}
```

### 字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `song_name` | 字符串 | 歌曲名称 |
| `artist` | 字符串 | 艺术家或作者名 |
| `bpm` | 整数 | 歌曲的BPM值 (节拍每分钟) |
| `difficulty` | 字符串 | 难度等级: Easy/Normal/Hard/Expert |
| `music_path` | 字符串 | 音乐文件的相对路径 |
| `notes` | 数组 | 音符列表 |

### 音符格式

每个音符包含两个属性：

- **time**: 音符出现的时间，单位为**毫秒** (ms)
  - 例如：`1000` = 歌曲开始后的第1秒
  - `2500` = 歌曲开始后的2.5秒

- **lane**: 音符所在的轨道，范围 **0-3**
  - `0` = 最左侧轨道 (对应按键 D)
  - `1` = 中左轨道 (对应按键 F)
  - `2` = 中右轨道 (对应按键 J)
  - `3` = 最右侧轨道 (对应按键 K)

## 制作谱面的步骤

### 1. 准备音乐文件
- 将音乐文件转换为 `.wav` 格式（推荐）或 `.mp3`
- 放在歌曲文件夹中，命名为 `music.wav`

### 2. 确定BPM
- 使用音乐软件或在线BPM检测工具获取歌曲的BPM值
- 如果歌曲有变速，使用平均BPM

### 3. 手动制作谱面
使用音乐编辑软件（如Audacity）：

1. 打开音乐文件
2. 找到需要放置音符的节拍点
3. 记录该位置的时间（以毫秒为单位）
4. 决定该音符应该在哪个轨道（0-3）
5. 在 `chart.json` 中添加该音符

示例：
```json
{"time": 1234, "lane": 0}  // 在1.234秒处，第0轨道添加音符
```

### 4. 使用自动生成工具
对于快速制作，可以使用项目提供的Python脚本：

```bash
python tools/auto_chart_generator.py songs/your-song/music.wav
```

这会自动分析音乐并生成基础谱面，之后可以手动调整。

## 调试与测试

1. 将谱面文件放在正确的位置
2. 启动游戏，选择你的歌曲
3. 测试游戏体验：
   - 音符是否在正确的节拍上
   - 难度是否合适
   - 是否有遗漏或错误的音符

4. 根据测试结果调整 `chart.json` 中的音符时间和位置

## 谱面设计建议

### 难度设置
- **Easy**: 稀疏的单轨音符，BPM较慢
- **Normal**: 较多单轨音符，偶尔出现双键
- **Hard**: 频繁的单键和双键组合
- **Expert**: 复杂的多键组合，快速连打

### 节奏对应
- 将音符放在明显的音乐节拍上（如鼓点、主旋律）
- 避免在不明显的地方放置音符
- 可以跟随人声、主旋律或节奏进行配置

### 示例参考

简单的4/4拍节奏（BPM 120）：
```json
{
  "notes": [
    {"time": 0, "lane": 0},      // 第1拍
    {"time": 500, "lane": 1},    // 第2拍
    {"time": 1000, "lane": 2},   // 第3拍
    {"time": 1500, "lane": 3},   // 第4拍
    {"time": 2000, "lane": 0}    // 下一小节第1拍
  ]
}
```

## 常见问题

**Q: 音符不在正确的节拍上怎么办？**
A: 重新测量时间，或者在音乐编辑软件中精确定位节拍点。

**Q: 可以有两个音符同时出现吗？**
A: 可以！只需要在两个不同轨道上使用相同的时间值即可。

**Q: 支持长按音符吗？**
A: 当前版本不支持，但可以在未来版本中添加。

**Q: 为什么音乐不能播放？**
A: 确保音乐文件格式正确（WAV最佳），并且路径在 `music_path` 中设置正确。

